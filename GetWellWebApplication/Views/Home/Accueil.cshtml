@model GetWellWebApplication.Models.medecin


@Styles.Render("~/Accueil/css")
<div id="Load">
    <div class="container">
        <div class="row">
            <div class=".col-md-4 col-sm-12 col-lg-4">
                <div id="Loader"></div>
            </div>
        </div>
    </div>
</div>
<div id="content">
    <div class="Loader_bg">
        <div class="Loader1"></div>
    </div>
    <header>
        <nav class="navbar sticky-top ">
            <a class="navbar-brand" href="#">
                <img src="~/Images/LogoPNG.png" class="Logo">
            </a>
            <form>
                <h5 id="med">Vous etes un Médecin?</h5>
                @Html.ActionLink("Inscrivez-Vous", "information_medecin", "Home", null, new { @class = "btn Btn-inscrire" })
            </form>
        </nav>
        <div class="container-fluid">

            <div class="row title-section">
                <div class=".col-md-4">
                    <div class="title-container">
                        <h1>Trouvez un Médecin</h1>
                        <p class="sub-title">Près de chez vous et prenez un rendez-vous en ligne.</p>
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-12 select-container">
                    <div class="input-group-text inp">
                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="20" fill="currentColor" class="bi bi-geo-alt icon2" viewBox="0 0 16 16">
                            <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A31.493 31.493 0 0 1 8 14.58a31.481 31.481 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94zM8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10z" />
                            <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                        </svg>
                        <input class="form-control inp-text" id="ville" placeholder="Votre ville" />
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="20" fill="currentColor" class="bi bi-clipboard-check icon1" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z" />
                            <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z" />
                            <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z" />
                        </svg>
                        @*@Html.DropDownList("Categorie", ViewBag.categorie as SelectList, "catégorie de recherche", new { @class = "form-control", @id = "categorie" })*@
                        <input class="form-control inp-text" id="categorie" placeholder="La specialité de votre recherche" />
                        <div>
                            <button class="btn Btn-Rechercher" type="button"><i class="fas fa-search icon"></i>Rechercher</button>
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 col-md-12 col-lg-12 ">
                    <div class="container select-bd">
                        <div class="row">
                            <div class="col-sm-12 col-md-12 col-lg-12 doctors-select center-doctors-select">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="row corps">
                    <div class="col-sm-12 col-md-12 col-lg-6 title2">
                        <h1>Ou Bien Vous ete un Médecin?</h1>
                        <p class="sub-title">
                            Rejoindre GetWell,
                            Et Télécharger notre Apllication Desktop pour gérer votre Rendez-Vous.GetWell est la meilleure façon de développer
                            l'activité de votre cabinet
                        </p>
                        <div class="text-center">
                            <a class="btn Btn-Rechercher" id="Telecharger" href="https://github.com/SyphaxGourar54/GetWell-Desktop/blob/master/GetWell_Setup.rar">Telecharger</a>
                            @Html.ActionLink("Inscrivez-Vous", "information_medecin", "Home", null, new { @class = "btn Btn-Rechercher", @id = "inscrivez" })
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-12 col-lg-6">
                        <img src="~/Images/doctor.jpg" id="dc" class="doctor-img1-container">
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Footer -->
    <footer class="bg-dark text-center text-white">
        <div class="container p-4">
            <div class="row foo1">
                <!--Grid column-->
                <div class="col-lg-6 col-md-12 mb-4 col-sm-12">
                    <img src="~/Images/LogoPNG.png" class="Logo1">
                </div>
                <div class="col-lg-6 col-md-12 col-sm-12">
                    <h5>Contacter le team GetWell</h5>
                </div>
                <div class="col-lg-6 col-md-12 col-sm-12">
                    <h6>A propos de nous</h6>
                    &copy; Copyrights GetWell 2021 - tous droits réservés
                </div>

            </div>

        </div>
    </footer>
</div>
<script type="text/javascript">
    var Doctors = {};
$(window).on('pageshow', function () {
    $('#Load').fadeOut(1000);
    $('#content').fadeIn(1000);
})
$(document).ready(function () {
    $('#ville').autocomplete({
        source: function (request, response) {
            $.ajax({
                url: '@Url.Action("GetCities", "Home")',
                dataType: 'JSON',
                data: { ville: $('#ville').val() },
                success: function (data) {
                    response($.map(data, function (item) {
                        return item.ville;
                    }));
                }
            })
        }
    })
    $('#categorie').autocomplete({
        source: function (request, response) {
            $.ajax({
                url: '@Url.Action("GetCategories", "Home")',
                dataType: 'JSON',
                data: { category: $('#categorie').val() },
                success: function (data) {
                    response($.map(data, function (item) {
                        return item.NomCat;
                    }));
                }
            })
        }
    })
    var DataLength = 0;
    $.ajax({
        url: '@Url.Action("GetAllDoctors", "Home")',
        type: 'GET',
        dataType: 'json',
        success: function (data) {
            if (data.length != 0) {
                Doctors = data;
                DataLength = data.length;
                $('.doctors-select').removeClass('center-doctors-select')
                $.each(data, function (i, item) {
                    $('.doctors-select').append("<div class='select-item' id='" + i + "'><div class='select-image-container'><img src='/" + item.Image + "' class='select-image' /></div><div class='paragraph-container'  name='" + item.Id_doc + "'><p class='item-name'>" + item.Nom + " " + item.Prenom + "</p><p class='item-adresse'>" + item.Adresse + "</p></div><div class='map-container' id='" + "map-" + i + "'></div></div>");
                })
                $('.select-item').on("mouseenter", function () {
                    var cont_id = $(this).attr('id');
                    $('#map-' + cont_id).animate({
                        height: "180px",
                        opacity: "1"
                    }, 500);
                    const { latitude, longitude } = data[cont_id];

                    const map = L.map('map-' + cont_id).setView([latitude, longitude], 13);
                    const attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'

                    const tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
                    const tiles = L.tileLayer(tileUrl, { attribution });
                    tiles.addTo(map);

                    var GetWellIcon = L.icon({
                        iconUrl: "/Images/LogoMarker5.png",
                        iconSize: [38, 35],
                        iconAnchor: [25, 16],
                        popupAnchor: [-3, -76],
                        shadowSize: [68, 95],
                        shadowAnchor: [22, 94]
                    });

                    const marker = L.marker([latitude, longitude], { icon: GetWellIcon }).addTo(map);
                });
                $('.select-item').on("mouseleave", function () {
                    var cont_id = $(this).attr('id');
                    $('#map-' + cont_id).animate({
                        height: "0px",
                        opacity: "0"
                    }, 500);
                });
                $('.paragraph-container').on('click', function () {
                    var id_doc = $(this).attr("name");
                    window.location.assign('/Home/index/' + id_doc)
                });
            }
            else {
                $('.doctors-select').addClass('center-doctors-select');
                $('.doctors-select').append("<img src='/Images/—Pngtree—vector cartoon illustration of cute_5532784.png' class='NotFoundImage' /><p>Nous avons cherché de haut en bas mais nous n'avons pas trouvé vous chercher</p>")
                $('.Loader_bg').fadeOut(1000);
            }
        }
    });
    $('.Btn-Rechercher').on('click', function () {
        Obj = {};
        Obj.Ville = $('#ville').val();
        Obj.Categorie = $('#categorie').val();
        $('.Loader_bg').fadeIn(1000);
        if (Obj.Categorie == null) {
            alert('Voulez-vous selectionner une specialité');
        }
        else if (Obj.Ville == null) {
            alert('Voulez-vous selectionner votre ville');
        }
        else {
            if ($('.doctors-select > .select-item').length > 0 ) {
                for (i = 0; i < DataLength; i++) {
                    document.querySelector('.select-item').remove();
                }
            }
            if ($('.doctors-select > img').length > 0) {
                $('.doctors-select > img').remove();
                $('.doctors-select > p').remove();
            }
            $.ajax({
                type: 'POST',
                url: '@Url.Action("SendDoctorsIdentifications", "Home")',
                dataType: 'json',
                data: "{dropDownValues:" + JSON.stringify(Obj) + "}",
                contentType: "application/json; charset: utf-8",
                complete: function () {
                    $.ajax({
                        url: '@Url.Action("GetDoctors", "Home")',
                        type: 'GET',
                        dataType: 'json',
                        success: function (data) {
                            if (data.length != 0) {
                                Doctors = data;
                                DataLength = data.length;
                                $('.doctors-select').removeClass('center-doctors-select')
                                $.each(data, function (i, item) {
                                    $('.doctors-select').append("<div class='select-item' id='" + i + "' name='" + item.Id_doc + "'><div class='select-image-container'><img src='" + item.Image + "' class='select-image' /></div><div class='paragraph-container'><p class='item-name'>" + item.Username + "</p><p class='item-adresse'>" + item.Adresse + "</p></div><div class='map-container' id='" + "map-" + i + "'></div></div>");

                                });
                                $('.Loader_bg').fadeOut(1000);
                                $('.select-item').on("mouseenter", function () {
                                    var cont_id = $(this).attr('id');
                                    $('#map-' + cont_id).animate({
                                        height: "180px",
                                        opacity: "1"
                                    }, 500);
                                    const { latitude, longitude } = data[cont_id];

                                    const map = L.map('map-' + cont_id).setView([latitude, longitude], 13);
                                    const attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'

                                    const tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
                                    const tiles = L.tileLayer(tileUrl, { attribution });
                                    tiles.addTo(map);

                                    var GetWellIcon = L.icon({
                                        iconUrl: "Images/LogoMarker5.png",
                                        iconSize: [38, 35],
                                        iconAnchor: [25, 16],
                                        popupAnchor: [-3, -76],
                                        shadowSize: [68, 95],
                                        shadowAnchor: [22, 94]
                                    });

                                    const marker = L.marker([latitude, longitude], { icon: GetWellIcon }).addTo(map);
                                });
                                $('.select-item').on("mouseleave", function () {
                                    var cont_id = $(this).attr('id');
                                    console.log(cont_id);
                                    $('#map-' + cont_id).animate({
                                        height: "0px",
                                        opacity: "0"
                                    }, 500);
                                });
                                $('.select-item').on('click', function () {
                                     var id_doc = $(this).attr("name");
                                     window.location.assign('/Home/index/' + id_doc)
                                });
                            }
                            else {
                                $('.doctors-select').addClass('center-doctors-select');
                                $('.doctors-select').append("<img src='/Images/—Pngtree—vector cartoon illustration of cute_5532784.png' class='NotFoundImage' /><p>Nous avons cherché de haut en bas mais nous n'avons pas trouvé vous chercher</p>")
                                $('.Loader_bg').fadeOut(1000);
                            }
                        }
                    });
                },
                error: function (error) {
                    console.log(error);
                }
            }).fail(function (response) {
                $('.Loader_bg').fadeOut(1000);
            });
        }
    });
});
</script>



